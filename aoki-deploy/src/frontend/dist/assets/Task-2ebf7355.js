import{d as K,r as u,f as s,o as p,n as U,w as t,e,u as c,L as P,c as $,F as H,v as G,b as V,y as oe,Y as B,Z as ne,Q as ie,R as T,x as b,i as O,a as Ve,h as N,$ as Ce,a0 as we,X as se,a1 as Ie,z as J,a2 as Re,V as de,K as $e,a3 as Me,B as z,q as ue,s as ce,_ as re,p as xe,U as Ue}from"./index-f12f2e9c.js";import{e as pe}from"./style-da0850c1.js";const Se={key:0},Le={style:{width:"100%",display:"flex","justify-content":"space-between","align-items":"center"}},De={key:1},qe={key:0},Ne={style:{width:"100%",display:"flex","justify-content":"space-between","align-items":"center"}},ze={key:1},Be=K({__name:"TaskMember",setup(C,{expose:k}){const I=u([]),h=u([]),r=u([]),w=u([]),n=u([]),i=u(!1),y=u({id:0,name:"作业名称"}),F=m=>{ie.confirm("是否确认取消?").then(()=>{m()}).catch(()=>{})},Q=m=>{y.value={id:m.id,name:m.name},X(),Y(),i.value=!0},X=()=>{T.getTaskMember(y.value.id).then(m=>{I.value=m.data}).catch(m=>{b("获取已完成作业的成员失败")})},Y=()=>{T.getNoTaskMember(y.value.id).then(m=>{h.value=m.data}).catch(m=>{b("获取未完成作业的成员失败")})},A=m=>{O.push({path:"task-score",query:{id:y.value.id,name:y.value.name,key:m}})};return k({showTaskMemberDrawer:Q}),(m,v)=>{const j=s("el-button"),D=s("el-avatar"),_=s("el-table-column"),q=s("el-table"),S=s("el-collapse-item"),M=s("el-collapse"),Z=s("el-drawer");return p(),U(Z,{modelValue:i.value,"onUpdate:modelValue":v[3]||(v[3]=d=>i.value=d),direction:"rtl","before-close":F,title:y.value.name},{default:t(()=>[e(M,{modelValue:n.value,"onUpdate:modelValue":v[2]||(v[2]=d=>n.value=d)},{default:t(()=>[e(S,{title:"已完成"},{default:t(()=>[c(P).teamMode?(p(),$("div",Se,[e(M,{modelValue:r.value,"onUpdate:modelValue":v[0]||(v[0]=d=>r.value=d)},{default:t(()=>[(p(!0),$(H,null,G(I.value,d=>(p(),U(S,{name:d.id},{title:t(()=>[V("div",Le,[V("span",null,oe(d.name),1),e(j,{type:"info",onClick:B(L=>A(d.id),["stop"]),circle:"",icon:c(ne)},null,8,["onClick","icon"])])]),default:t(()=>[e(q,{data:d.memberList,"show-header":!1,style:{height:"100%"}},{default:t(()=>[e(_,{prop:"avatarURL",label:"头像"},{default:t(L=>[e(D,{src:L.row.avatarURL,fit:"scale-down",size:"small"},null,8,["src"])]),_:1}),e(_,{prop:"name",label:"姓名"}),e(_,{prop:"username",label:"学号"})]),_:2},1032,["data"])]),_:2},1032,["name"]))),256))]),_:1},8,["modelValue"])])):(p(),$("div",De,[e(q,{data:I.value,"show-header":!1,style:{height:"100%"}},{default:t(()=>[e(_,{prop:"avatarURL",label:"头像"},{default:t(({row:d})=>[e(D,{src:d.avatarURL,fit:"scale-down",size:"small"},null,8,["src"])]),_:1}),e(_,{prop:"name",label:"姓名"}),e(_,{prop:"username",label:"学号"}),e(_,null,{default:t(({row:d})=>[e(j,{type:"info",circle:"",onClick:L=>A(d.id),icon:c(ne)},null,8,["onClick","icon"])]),_:1})]),_:1},8,["data"])]))]),_:1}),e(S,{title:"未完成"},{default:t(()=>[c(P).teamMode?(p(),$("div",qe,[e(M,{modelValue:w.value,"onUpdate:modelValue":v[1]||(v[1]=d=>w.value=d)},{default:t(()=>[(p(!0),$(H,null,G(h.value,d=>(p(),U(S,{name:d.id},{title:t(()=>[V("div",Ne,[V("span",null,oe(d.name),1)])]),default:t(()=>[e(q,{data:d.memberList,"show-header":!1,style:{height:"100%"}},{default:t(()=>[e(_,{prop:"avatarURL",label:"头像"},{default:t(L=>[e(D,{src:L.row.avatarURL,fit:"scale-down",size:"small"},null,8,["src"])]),_:1}),e(_,{prop:"name",label:"姓名"}),e(_,{prop:"username",label:"学号"})]),_:2},1032,["data"])]),_:2},1032,["name"]))),256))]),_:1},8,["modelValue"])])):(p(),$("div",ze,[e(q,{data:h.value,"show-header":!1,style:{height:"100%"}},{default:t(()=>[e(_,{prop:"avatarURL",label:"头像"},{default:t(({row:d})=>[e(D,{src:d.avatarURL,fit:"scale-down",size:"small"},null,8,["src"])]),_:1}),e(_,{prop:"name",label:"姓名"}),e(_,{prop:"username",label:"学号"})]),_:1},8,["data"])]))]),_:1})]),_:1},8,["modelValue"])]),_:1},8,["modelValue","title"])}}}),Ee=C=>(ue("data-v-3cd847d1"),C=C(),ce(),C),Fe={class:"card-header"},Ye=Ee(()=>V("h2",{style:{margin:"auto"}},"我的作业",-1)),Ae={class:"dialog-footer"},je={style:{display:"flex","justify-content":"space-between","align-items":"center"}},Pe=["id"],He={class:"dialog-footer"},Oe=K({__name:"TaskTeacher",setup(C){const k=u(!1),I=u(!1),h=u(!1),r=u(!0),w=u(!0),n=u({id:0,name:"",publish:!1,topicId:null,time:["",""]}),i=u({id:0,name:"",limit:100,taskId:0}),y=l=>{ie.confirm("是否确认取消?").then(()=>{l()}).catch(()=>{})},F=u(),Q=Ve({name:[{required:!0,message:"请输入课题名",trigger:"blur"}],topicId:[{required:!0,message:"请选择所属课程",trigger:"blur"}],time:[{required:!0,message:"请选择作业开始与结束时间",trigger:"blur"}]}),X=async l=>{l&&await l.validate((a,f)=>{if(a){const g={id:n.value.id,name:n.value.name,publish:n.value.publish,topicId:n.value.topicId,beginTime:n.value.time[0],endTime:n.value.time[1]};r.value?T.createTask(g).then(x=>{z("创建成功"),v()}).catch(x=>{b("创建失败")}):T.updateTask(g).then(x=>{z("更新成功"),v()}).catch(x=>{b("更新失败")}),k.value=!1}})},Y=u([]),A=()=>{T.getMyTopics(P.value.id).then(l=>{Y.value=l.data}).catch(l=>{b("获取我的课题失败"),b(l.message)})},m=u([]),v=()=>{T.getOwnerTasks(P.value.id).then(l=>{m.value=l.data}).catch(l=>{b("获取作业列表失败")})},j=l=>{r.value=!1,n.value.id=l.id,n.value.name=l.name,n.value.topicId=l.topicId,n.value.time=[l.beginTime,l.endTime],k.value=!0},D=l=>{T.deleteTask(l).then(a=>{v(),z("删除成功")}).catch(a=>{b("删除失败")})},_=l=>{T.toggleTaskPublish(l).then(a=>{v()}).catch(a=>{b("错误")})},q=l=>{M(l),i.value.taskId=l,I.value=!0},S=u([]),M=l=>{T.getScoreRule(l).then(a=>{S.value=a.data}).catch(a=>{b("获取评分规则列表失败")})},Z=()=>{const l={id:i.value.id,name:i.value.name,taskId:i.value.taskId,limit:i.value.limit};w?T.createScoreRule(l).then(a=>{M(l.taskId),h.value=!1,z("创建成功")}).catch(a=>{b("创建失败")}):T.updateScoreRule(l).then(a=>{M(l.taskId),h.value=!1,z("修改成功")}).catch(a=>{b("修改失败")})},d=l=>{T.deleteScoreRule(l.id).then(a=>{M(l.taskId),z("删除成功")}).catch(a=>{b("删除失败")})},L=l=>{w.value=!1,i.value.id=l.id,i.value.name=l.name,i.value.taskId=l.taskId,i.value.limit=l.limit,h.value=!0},me=()=>{A(),r.value=!0,k.value=!0},W=u(),_e=l=>{W.value.showTaskMemberDrawer(l)};return v(),(l,a)=>{const f=s("el-button"),g=s("el-table-column"),x=s("el-tooltip"),ve=s("el-popconfirm"),ee=s("el-table"),fe=s("el-card"),te=s("el-input"),E=s("el-form-item"),be=s("el-option"),he=s("el-select"),ke=s("el-date-picker"),le=s("el-form"),ae=s("el-dialog"),ye=s("el-drawer"),ge=s("el-input-number");return p(),$(H,null,[e(fe,{class:"box-card","body-style":c(pe)},{header:t(()=>[V("div",Fe,[Ye,e(f,{type:"primary",onClick:me},{default:t(()=>[N("新建")]),_:1})])]),default:t(()=>[e(ee,{data:m.value,style:{height:"100%"},onRowClick:_e},{default:t(()=>[e(g,{prop:"name",label:"名称"}),e(g,{prop:"topicName",label:"所属课题"}),e(g,{prop:"beginTime",label:"开始时间"}),e(g,{prop:"endTime",label:"截至时间"}),e(g,{label:"发布",prop:"publish"}),e(g,{label:"操作"},{default:t(({row:o})=>[e(x,{content:o.publish?"取消发布":"发布作业",placement:"bottom"},{default:t(()=>[e(f,{type:o.publish?"":"success",icon:o.publish?c(Ce):c(we),circle:"",onClick:B(R=>_(o.id),["stop"])},null,8,["type","icon","onClick"])]),_:2},1032,["content"]),e(x,{content:"编辑",placement:"bottom"},{default:t(()=>[e(f,{type:"primary",icon:c(se),circle:"",onClick:B(R=>j(o),["stop"])},null,8,["icon","onClick"])]),_:2},1024),e(x,{content:"题目",placement:"bottom"},{default:t(()=>[e(f,{type:"info",icon:c(Ie),circle:"",onClick:B(R=>c(J).setItem("redirectPath",c(O).currentRoute.value.path)||c(O).push({path:"question",query:{taskId:o.id}}),["stop"])},null,8,["icon","onClick"])]),_:2},1024),e(x,{content:"评分规则",placement:"bottom"},{default:t(()=>[e(f,{type:"warning",icon:c(Re),circle:"",onClick:B(R=>q(o.id),["stop"])},null,8,["icon","onClick"])]),_:2},1024),e(ve,{title:"Are you sure to delete this?"},{reference:t(()=>[e(f,{type:"danger",icon:c(de),circle:"",onClick:B(R=>D(o.id),["stop"])},null,8,["icon","onClick"])]),_:2},1024)]),_:1})]),_:1},8,["data"])]),_:1},8,["body-style"]),e(ae,{modelValue:k.value,"onUpdate:modelValue":a[5]||(a[5]=o=>k.value=o),title:r.value?"新建作业":"修改作业","before-close":y,"align-center":"",center:"",width:"513px"},{footer:t(()=>[V("span",Ae,[e(f,{onClick:a[3]||(a[3]=o=>k.value=!1)},{default:t(()=>[N("取消")]),_:1}),e(f,{type:"primary",onClick:a[4]||(a[4]=o=>X(F.value))},{default:t(()=>[N(" 确认 ")]),_:1})])]),default:t(()=>[e(le,{ref_key:"ruleFormRef",ref:F,model:n.value,"label-width":"120px",rules:Q,"label-position":"top",inline:!0},{default:t(()=>[e(E,{label:"作业名称",prop:"name"},{default:t(()=>[e(te,{modelValue:n.value.name,"onUpdate:modelValue":a[0]||(a[0]=o=>n.value.name=o),placeholder:"请输入作业名"},null,8,["modelValue"])]),_:1}),r.value?(p(),U(E,{key:0,label:"所属课题",prop:"topicId"},{default:t(()=>[e(he,{modelValue:n.value.topicId,"onUpdate:modelValue":a[1]||(a[1]=o=>n.value.topicId=o),placeholder:"请选择所属课题",style:{width:"200px"}},{default:t(()=>[(p(!0),$(H,null,G(Y.value,(o,R)=>(p(),U(be,{key:R,value:o.id,label:o.name},null,8,["value","label"]))),128))]),_:1},8,["modelValue"])]),_:1})):$e("",!0),e(E,{label:"开始与结束时间",prop:"time"},{default:t(()=>[e(ke,{modelValue:n.value.time,"onUpdate:modelValue":a[2]||(a[2]=o=>n.value.time=o),type:"datetimerange","start-placeholder":"Start Date","end-placeholder":"End Date","value-format":"YYYY-MM-DD HH:mm:ss"},null,8,["modelValue"])]),_:1})]),_:1},8,["model","rules"])]),_:1},8,["modelValue","title"]),e(ye,{modelValue:I.value,"onUpdate:modelValue":a[7]||(a[7]=o=>I.value=o),direction:"ltr","before-close":y},{header:t(({close:o,titleId:R,titleClass:Te})=>[V("div",je,[V("h4",{id:R,class:Me(Te)},"评分规则",10,Pe),e(f,{type:"primary",onClick:a[6]||(a[6]=We=>(w.value=!0)&&(h.value=!0))},{default:t(()=>[N("新建")]),_:1})])]),default:t(()=>[e(ee,{data:S.value,style:{height:"100%"}},{default:t(()=>[e(g,{prop:"name",label:"名称"}),e(g,{prop:"limit",label:"分数上限"}),e(g,{label:"操作"},{default:t(({row:o})=>[e(f,{circle:"",type:"primary",icon:c(se),onClick:R=>L(o)},null,8,["icon","onClick"]),e(f,{circle:"",type:"danger",icon:c(de),onClick:R=>d(o)},null,8,["icon","onClick"])]),_:1})]),_:1},8,["data"])]),_:1},8,["modelValue"]),e(ae,{modelValue:h.value,"onUpdate:modelValue":a[11]||(a[11]=o=>h.value=o),title:w.value?"新建评分规则":"修改评分规则","before-close":y,"align-center":"",center:"",width:"513px"},{footer:t(()=>[V("span",He,[e(f,{onClick:a[10]||(a[10]=o=>h.value=!1)},{default:t(()=>[N("取消")]),_:1}),e(f,{type:"primary",onClick:Z,disabled:i.value.name.length===0},{default:t(()=>[N(" 确认 ")]),_:1},8,["disabled"])])]),default:t(()=>[e(le,{model:i.value,"label-width":"120px"},{default:t(()=>[e(E,{label:"评分规则名称",prop:"name"},{default:t(()=>[e(te,{modelValue:i.value.name,"onUpdate:modelValue":a[8]||(a[8]=o=>i.value.name=o),placeholder:"请输入评分名"},null,8,["modelValue"])]),_:1}),e(E,{label:"分数上限",prop:"limit"},{default:t(()=>[e(ge,{modelValue:i.value.limit,"onUpdate:modelValue":a[9]||(a[9]=o=>i.value.limit=o),precision:1,step:.1,max:100},null,8,["modelValue","step"])]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue","title"]),e(Be,{ref_key:"taskMemberRef",ref:W},null,512)],64)}}});const Ke=re(Oe,[["__scopeId","data-v-3cd847d1"]]),Qe=C=>(ue("data-v-acf710cf"),C=C(),ce(),C),Xe=Qe(()=>V("div",{class:"card-header"},[V("h2",{style:{margin:"auto"}},"我的作业")],-1)),Ze=K({__name:"TaskStudent",setup(C){const k=u([]),I=()=>{const r=J.getItem("topic");r!=null&&r.id&&xe.getMemberTasks(r.id).then(w=>{k.value=w.data}).catch(w=>{b("获取作业列表失败")})},h=r=>{J.setItem("task",{id:r.id,name:r.name}),O.push("task-edit")};return I(),(r,w)=>{const n=s("el-table-column"),i=s("el-table"),y=s("el-card");return p(),U(y,{class:"box-card","body-style":c(pe)},{header:t(()=>[Xe]),default:t(()=>[e(i,{data:k.value,style:{height:"100%"},onRowClick:h},{default:t(()=>[e(n,{prop:"name",label:"名称"}),e(n,{prop:"beginTime",label:"开始时间"}),e(n,{prop:"endTime",label:"截至时间"}),e(n,{prop:"submitted",label:"是否提交"})]),_:1},8,["data"])]),_:1},8,["body-style"])}}});const Ge=re(Ze,[["__scopeId","data-v-acf710cf"]]),Je={style:{display:"flex",width:"100%",height:"100%"}},lt=K({__name:"Task",setup(C){return(k,I)=>(p(),$("div",Je,[c(Ue).role===2?(p(),U(Ge,{key:0})):(p(),U(Ke,{key:1}))]))}});export{lt as default};
