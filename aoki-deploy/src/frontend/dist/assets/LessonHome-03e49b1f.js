import{d as Z,r as p,a as z,o as w,n as h,w as t,b as _,e,h as L,P as Q,Q as se,L as d,R as B,B as W,x,f as i,c as de,F as ie,p as O,u as o,y as H,U as g,K as k,T as K,V as P,W as re,X as ue,q as me,s as ce,_ as pe}from"./index-f12f2e9c.js";import{e as j}from"./style-da0850c1.js";const fe={class:"dialog-footer"},_e=Z({__name:"MilestonesEdit",emits:["refreshMilestonesList"],setup(I,{expose:T,emit:M}){const C=p(!0),b=p(!1);T({showCreateDialog:()=>{C.value=!0,b.value=!0},showUpdateDialog:u=>{C.value=!1,s.id=u.id,s.name=u.name,s.introduction=u.introduction,s.date=[u.beginTime,u.endTime],b.value=!0}});const U=u=>{se.confirm("是否确认取消?").then(()=>{u()}).catch(()=>{})},s=z({id:0,name:"",date:["",""],introduction:""}),Y=p(),R=z({name:[{required:!0,message:"请输入任务名",trigger:"blur"}],date:[{required:!0,message:"请选择起止日期",trigger:"blur"}]}),A=async u=>{u&&await u.validate((r,F)=>{if(r){const V={id:s.id,name:s.name,beginTime:s.date[0],endTime:s.date[1],introduction:s.introduction,lessonId:d.value.id};C.value?B.addMilestones(V).then(y=>{M("refreshMilestonesList"),W("新建阶段任务成功"),b.value=!1}).catch(y=>{x("新建阶段任务失败")}):B.updateMilestones(V).then(y=>{M("refreshMilestonesList"),W("修改阶段任务成功"),b.value=!1}).catch(y=>{x("修改阶段任务失败")})}})};return(u,r)=>{const F=i("el-input"),V=i("el-form-item"),y=i("el-date-picker"),S=i("el-form"),E=i("el-button"),N=i("el-dialog");return w(),h(N,{modelValue:b.value,"onUpdate:modelValue":r[5]||(r[5]=v=>b.value=v),title:C.value?"新建阶段任务":"修改阶段任务","before-close":U,"align-center":"",center:"",width:"1005px"},{footer:t(()=>[_("span",fe,[e(E,{onClick:r[3]||(r[3]=v=>b.value=!1)},{default:t(()=>[L("取消")]),_:1}),e(E,{type:"primary",onClick:r[4]||(r[4]=v=>A(Y.value))},{default:t(()=>[L(" 确认 ")]),_:1})])]),default:t(()=>[e(S,{ref_key:"ruleFormRef",ref:Y,model:s,"label-width":"120px",rules:R,"label-position":"top",inline:!0},{default:t(()=>[e(V,{label:"阶段目标名称",prop:"name",style:{width:"40%","margin-right":"10%"}},{default:t(()=>[e(F,{modelValue:s.name,"onUpdate:modelValue":r[0]||(r[0]=v=>s.name=v),placeholder:"请输入任务名"},null,8,["modelValue"])]),_:1}),e(V,{label:"起始时间",prop:"date"},{default:t(()=>[e(y,{modelValue:s.date,"onUpdate:modelValue":r[1]||(r[1]=v=>s.date=v),type:"daterange","start-placeholder":"Start Date","end-placeholder":"End Date","value-format":"YYYY-MM-DD"},null,8,["modelValue"])]),_:1}),e(V,{label:"任务描述",prop:"introduction"},{default:t(()=>[e(Q,{modelValue:s.introduction,"onUpdate:modelValue":r[2]||(r[2]=v=>s.introduction=v)},null,8,["modelValue"])]),_:1})]),_:1},8,["model","rules"])]),_:1},8,["modelValue","title"])}}}),X=I=>(me("data-v-6a098cf8"),I=I(),ce(),I),ve={class:"card-header"},we={style:{"font-size":"var(--el-font-size-small)"}},be={class:"card-header"},he=X(()=>_("span",null,"老师联系方式",-1)),ye={class:"card-header"},ge=X(()=>_("span",null,"阶段任务",-1)),ke={class:"card-header"},Ve=X(()=>_("span",null,"学生列表",-1)),Me={class:"dialog-footer"},Ce=Z({__name:"LessonHome",setup(I){const T=p([]),M=p([]),C=()=>{O.getLessonMember(d.value.id).then(n=>{T.value.length=M.value.length=0,n==null||n.data.forEach(l=>{switch(l.role){case 1:T.value.push(l);break;case 2:M.value.push(l);break}})}).catch(n=>{x("获取课程成员失败")})};C();const b=p([]),q=()=>{O.getMilestones(d.value.id).then(n=>{b.value=n==null?void 0:n.data}).catch(n=>{x("获取阶段任务失败")})};q();const D=p(!1),U=z({username:""}),s=p(),Y=z({username:[{required:!0,message:"请填写学工号",trigger:"blur"},{min:3,max:12,message:"请填写正确的学工号",trigger:"blur"}]}),R=p(!1),A=async n=>{n&&await n.validate((l,$)=>{l?(R.value=!0,B.addLessonMember(U.username,d.value.id).then(m=>{var f;switch((f=m==null?void 0:m.data)==null?void 0:f.role){case 1:T.value.push(m==null?void 0:m.data);break;case 2:M.value.push(m==null?void 0:m.data);break}D.value=!1,R.value=!1,W("添加用户成功")}).catch(m=>{x("添加用户失败")})):console.log("error submit!",$)})},u=p([]),r=n=>{u.value=n},F=n=>{B.removeLessonMembers(d.value.id,n).then(l=>{C()}).catch(l=>{x("删除用户失败:"+l.message)})},V=n=>{B.deleteMilestones(d.value.id,n.map(l=>l.id)).then(l=>{q()}).catch(l=>{x("删除阶段任务失败:"+l.message)})},y=p(null),S=p(!1),E=p(""),N=p(""),v=n=>{E.value=n.name,N.value=n.introduction,S.value=!0};return(n,l)=>{const $=i("el-card"),m=i("el-col"),f=i("el-button"),c=i("el-table-column"),G=i("el-row"),ee=i("el-space"),te=i("el-input"),le=i("el-form-item"),oe=i("el-form"),ae=i("el-dialog"),ne=i("el-drawer");return w(),de(ie,null,[e(G,{justify:"space-between"},{default:t(()=>[e(m,{span:12},{default:t(()=>[e($,{"body-style":o(j)},{header:t(()=>[_("div",ve,[_("span",null,H(o(d).name),1),_("span",we,H(o(d).ownerName),1)])]),default:t(()=>[e(Q,{modelValue:o(d).introduction,"onUpdate:modelValue":l[0]||(l[0]=a=>o(d).introduction=a),"preview-only":!0,style:{"padding-left":"8px","padding-right":"8px"}},null,8,["modelValue"])]),_:1},8,["body-style"])]),_:1}),e(m,{span:12},{default:t(()=>[e($,{"body-style":o(j)},{header:t(()=>[_("div",be,[he,o(d).ownerName===o(g).name?(w(),h(f,{key:0,class:"button",text:"",onClick:l[1]||(l[1]=a=>D.value=!0)},{default:t(()=>[L("添加老师")]),_:1})):k("",!0)])]),default:t(()=>[e(o(K),{data:T.value,style:{width:"100%",height:"100%"}},{default:t(()=>[e(c,{prop:"name",label:"姓名",style:{width:"50%"},"overflow-tooltip":!0}),e(c,{prop:"email",label:"邮箱",style:{width:"50%"},"overflow-tooltip":!0}),o(d).ownerId===o(g).id?(w(),h(c,{key:0,label:"操作"},{default:t(({row:a})=>[a.id!==o(g).id?(w(),h(f,{key:0,type:"danger",icon:o(P),circle:"",onClick:J=>F(a.id)},null,8,["icon","onClick"])):k("",!0)]),_:1})):k("",!0)]),_:1},8,["data"])]),_:1},8,["body-style"])]),_:1})]),_:1}),e(G,{justify:"space-between"},{default:t(()=>[e(m,{span:12},{default:t(()=>[e($,{"body-style":o(j)},{header:t(()=>[_("div",ye,[ge,o(d).ownerId===o(g).id?(w(),h(ee,{key:0},{default:t(()=>[e(f,{class:"button",text:"",onClick:l[2]||(l[2]=a=>y.value.showCreateDialog())},{default:t(()=>[L("添加任务")]),_:1}),e(f,{type:"danger",icon:o(P),circle:"",disabled:u.value.length===0,onClick:l[3]||(l[3]=a=>V(u.value))},null,8,["icon","disabled"])]),_:1})):k("",!0)])]),default:t(()=>[e(o(K),{data:b.value,style:{width:"100%",height:"100%"},onSelectionChange:r,onRowClick:v},{default:t(()=>[o(d).ownerName===o(g).name?(w(),h(c,{key:0,type:"selection",width:"55"})):k("",!0),e(c,{prop:"name",label:"任务名",style:{width:"25%"},"overflow-tooltip":!0}),e(c,{prop:"beginTime",label:"开始时间",style:{width:"25%"},"overflow-tooltip":!0}),e(c,{prop:"endTime",label:"结束时间",style:{width:"25%"},"overflow-tooltip":!0}),e(c,{label:"状态",style:{width:"25%"}},{default:t(a=>[_("span",{style:re({color:new Date(a.row.beginTime)>new Date?"gray":new Date(a.row.endTime)<new Date?"red":"green"})},H(new Date(a.row.beginTime)>new Date?"未开始":new Date(a.row.endTime)<new Date?"已结束":"进行中"),5)]),_:1}),o(d).ownerId===o(g).id?(w(),h(c,{key:1,label:"编辑",width:"60"},{default:t(a=>[e(f,{icon:o(ue),circle:"",onClick:J=>y.value.showUpdateDialog(a.row)},null,8,["icon","onClick"])]),_:1})):k("",!0)]),_:1},8,["data"])]),_:1},8,["body-style"])]),_:1}),e(m,{span:12},{default:t(()=>[e($,{"body-style":o(j)},{header:t(()=>[_("div",ke,[Ve,o(d).ownerId===o(g).id?(w(),h(f,{key:0,class:"button",text:"",onClick:l[4]||(l[4]=a=>D.value=!0)},{default:t(()=>[L("添加学生")]),_:1})):k("",!0)])]),default:t(()=>[e(o(K),{data:M.value,style:{width:"100%",height:"100%"}},{default:t(()=>[e(c,{prop:"name",label:"姓名",style:{width:"25%"},"overflow-tooltip":!0}),e(c,{prop:"username",label:"学号",style:{width:"25%"},"overflow-tooltip":!0}),e(c,{prop:"email",label:"邮箱",style:{width:"25%"},"overflow-tooltip":!0}),e(c,{prop:"major",label:"专业",style:{width:"25%"},"overflow-tooltip":!0}),o(d).ownerId===o(g).id?(w(),h(c,{key:0,label:"操作"},{default:t(({row:a})=>[a.id!==o(g).id?(w(),h(f,{key:0,type:"danger",icon:o(P),circle:"",onClick:J=>F(a.id)},null,8,["icon","onClick"])):k("",!0)]),_:1})):k("",!0)]),_:1},8,["data"])]),_:1},8,["body-style"])]),_:1})]),_:1}),e(ae,{modelValue:D.value,"onUpdate:modelValue":l[8]||(l[8]=a=>D.value=a),title:"添加用户",width:"30%",center:"","align-center":""},{footer:t(()=>[_("span",Me,[e(f,{onClick:l[6]||(l[6]=a=>D.value=!1)},{default:t(()=>[L("Cancel")]),_:1}),e(f,{type:"primary",onClick:l[7]||(l[7]=a=>A(s.value)),loading:R.value},{default:t(()=>[L(" Confirm ")]),_:1},8,["loading"])])]),default:t(()=>[e(oe,{ref_key:"addLessonMemberFormRef",ref:s,model:U,rules:Y,"label-width":"120px",class:"demo-ruleForm","status-icon":""},{default:t(()=>[e(le,{label:"学工号",prop:"username","label-width":"20%"},{default:t(()=>[e(te,{modelValue:U.username,"onUpdate:modelValue":l[5]||(l[5]=a=>U.username=a)},null,8,["modelValue"])]),_:1})]),_:1},8,["model","rules"])]),_:1},8,["modelValue"]),e(_e,{ref_key:"milestonesEditRef",ref:y,onRefreshMilestonesList:q},null,512),e(ne,{modelValue:S.value,"onUpdate:modelValue":l[10]||(l[10]=a=>S.value=a),title:E.value},{default:t(()=>[e(Q,{"preview-only":!0,modelValue:N.value,"onUpdate:modelValue":l[9]||(l[9]=a=>N.value=a)},null,8,["modelValue"])]),_:1},8,["modelValue","title"])],64)}}});const xe=pe(Ce,[["__scopeId","data-v-6a098cf8"]]);export{xe as default};
