import{d as E,r as b,a as R,o as h,n as I,w as t,e,b as u,h as z,u as m,U as k,p as A,B,f as a,q as L,s as N,_ as D,c as M,C as T,S as H,D as $,E as J,G as W,H as K,I as Q,F as X,x as y,J as Y,z as Z}from"./index-3165b167.js";const F=r=>(L("data-v-194c2231"),r=r(),N(),r),ee=F(()=>u("p",{class:"section-title"},"更改密码",-1)),te=F(()=>u("div",{class:"separator hidden-md-and-down"},null,-1)),le=F(()=>u("p",null,null,-1)),oe=F(()=>u("p",{class:"section-title"},"更改邮箱",-1)),ae=E({__name:"Account",setup(r){const i=b(!1),U=b(Date.now()),f=()=>{A.getVerifyCode(l.email).then(s=>{U.value=Date.now()+1e3*60,i.value=!0})},c=R({newPassword:"",oldPassword:""}),w=b(),V=R({oldPassword:[{required:!0,message:"请输入当前",trigger:"blur"},{min:6,max:20,message:"密码不少于6位不大于20位"}],newPassword:[{required:!0,message:"请输入新密码",trigger:"blur"},{min:6,max:20,message:"密码不少于6位不大于20位"}]}),x=async s=>{s&&await s.validate((o,p)=>{o&&A.updatePassword(c).then(n=>{B("密码修改成功")})})},S=async s=>{s&&await s.validate((o,p)=>{o&&A.updateEmail(l).then(n=>{k.email=l.email,B("邮箱修改成功")})})},l=R({code:"",email:"",password:""}),_=b(),g=R({password:[{required:!0,message:"请输入当前",trigger:"blur"},{min:6,max:20,message:"密码不少于6位不大于20位"}],email:[{required:!0,message:"请输入邮箱",trigger:"blur"},{type:"email",message:"请输入正确的邮箱"}],code:[{required:!0,message:"请输入验证码",trigger:"blur"},{len:6,message:"请输入正确验证码"}]});return(s,o)=>{const p=a("el-input"),n=a("el-form-item"),v=a("el-button"),P=a("el-form"),C=a("el-col"),G=a("el-countdown"),O=a("el-row");return h(),I(O,null,{default:t(()=>[e(C,{span:11},{default:t(()=>[u("div",null,[ee,e(P,{ref_key:"ruleFormRefU",ref:w,model:c,rules:V,"label-position":"top"},{default:t(()=>[e(n,{label:"当前密码",prop:"oldPassword"},{default:t(()=>[e(p,{modelValue:c.oldPassword,"onUpdate:modelValue":o[0]||(o[0]=d=>c.oldPassword=d)},null,8,["modelValue"])]),_:1}),e(n,{label:"新密码",prop:"newPassword"},{default:t(()=>[e(p,{modelValue:c.newPassword,"onUpdate:modelValue":o[1]||(o[1]=d=>c.newPassword=d)},null,8,["modelValue"])]),_:1}),e(n,null,{default:t(()=>[e(v,{type:"primary",onClick:o[2]||(o[2]=d=>x(w.value))},{default:t(()=>[z("更新密码")]),_:1})]),_:1})]),_:1},8,["model","rules"])])]),_:1}),e(C,{span:2},{default:t(()=>[te,le]),_:1}),e(C,{span:11},{default:t(()=>[u("div",null,[oe,e(P,{ref_key:"ruleFormRefE",ref:_,model:l,rules:g,"label-position":"top"},{default:t(()=>[e(n,{label:"当前密码",prop:"password"},{default:t(()=>[e(p,{modelValue:l.password,"onUpdate:modelValue":o[3]||(o[3]=d=>l.password=d)},null,8,["modelValue"])]),_:1}),e(n,{label:"当前邮箱"},{default:t(()=>[e(p,{modelValue:m(k).email,"onUpdate:modelValue":o[4]||(o[4]=d=>m(k).email=d),disabled:""},null,8,["modelValue"])]),_:1}),e(n,{label:"新邮箱",prop:"email"},{default:t(()=>[e(p,{modelValue:l.email,"onUpdate:modelValue":o[5]||(o[5]=d=>l.email=d)},null,8,["modelValue"]),i.value?(h(),I(G,{key:0,format:"ss",value:U.value,style:{position:"absolute",right:"10px"},"value-style":"color:#409eff;font-size: 14px",onFinish:o[6]||(o[6]=d=>i.value=!1)},null,8,["value"])):(h(),I(v,{key:1,style:{position:"absolute",right:"10px"},type:"text",onClick:f},{default:t(()=>[z("获取验证码 ")]),_:1}))]),_:1}),e(n,{label:"验证码",prop:"code"},{default:t(()=>[e(p,{modelValue:l.code,"onUpdate:modelValue":o[7]||(o[7]=d=>l.code=d)},null,8,["modelValue"])]),_:1}),e(n,null,{default:t(()=>[e(v,{type:"primary",onClick:o[8]||(o[8]=d=>S(_.value))},{default:t(()=>[z("更新邮箱")]),_:1})]),_:1})]),_:1},8,["model","rules"])])]),_:1})]),_:1})}}});const se=D(ae,[["__scopeId","data-v-194c2231"]]),q=r=>(L("data-v-83f891f9"),r=r(),N(),r),ne=q(()=>u("div",{class:"section-title"},"头像设置",-1)),re={class:"section-main"},de=q(()=>u("div",{class:"separator hidden-md-and-down"},null,-1)),ue=q(()=>u("p",null,null,-1)),ie=q(()=>u("div",{class:"el-upload__text"},[z(" 把图像拖放到此处 "),u("em",null,"单击此处")],-1)),ce={key:1,style:{width:"200px",height:"200px",display:"inline-block"}},_e=E({__name:"UserInfo",setup(r){const i=b(""),U={viewMode:1,dragMode:"move",aspectRatio:1,cropBoxResizable:!1},f=b(!1),c=(l,_)=>{var g;if(!((g=l.raw)!=null&&g.type.startsWith("image/")))return y("上传必须为图片"),!1;if(l.size&&l.size>1024*1024*2)return y("上传头像图片大小不能超过 2MB"),!1;i.value=URL.createObjectURL(l.raw)},w=()=>{var l;(l=$)==null||l.rotate(-90)},V=()=>{var l;(l=$)==null||l.rotate(90)},x=()=>{i.value=""},S=()=>{var l;f.value=!0,(l=$)==null||l.getBlob().then(_=>{if(!_){y("图片获取为空");return}console.log(_.type);let g=new window.File([_],"avatar.png");Y.uploadAvatar(g).then(s=>{s&&A.updateAvatar(s.data).then(o=>{B("头像上传成功"),k.value.avatarURL=s.data,Z.setItem("User",k),x()}).catch(o=>{y(o.toString()),y("图片加载失败")})})}).catch(_=>{y(_.toString()),y("图片加载失败")}),f.value=!1};return(l,_)=>{const g=a("el-avatar"),s=a("el-col"),o=a("el-icon"),p=a("el-upload"),n=a("el-button"),v=a("el-tooltip"),P=a("el-space"),C=a("el-row");return h(),M(X,null,[ne,u("div",re,[e(C,null,{default:t(()=>[e(s,{span:11,style:{display:"flex","align-items":"center","justify-content":"center"}},{default:t(()=>[e(g,{inline:!0,size:150,style:{"margin-bottom":"15px"},src:m(k).avatarURL},null,8,["src"])]),_:1}),e(s,{span:2},{default:t(()=>[de,ue]),_:1}),e(s,{span:11},{default:t(()=>[i.value?(h(),M("div",ce,[e(m(H),{ref_key:"cropper",ref:$,options:U,img:i.value},null,8,["img"]),e(P,null,{default:t(()=>[e(v,{class:"item",effect:"dark",content:"向左旋转90°",trigger:"hover",placement:"bottom"},{default:t(()=>[e(n,{onClick:w,icon:m(J),size:"small"},null,8,["icon"])]),_:1}),e(v,{class:"item",effect:"dark",content:"向右旋转90°",trigger:"hover",placement:"bottom"},{default:t(()=>[e(n,{onClick:V,icon:m(W),size:"small"},null,8,["icon"])]),_:1}),e(v,{class:"item",effect:"dark",content:"关闭图像截取",trigger:"hover",placement:"bottom"},{default:t(()=>[e(n,{onClick:x,icon:m(K),size:"small"},null,8,["icon"])]),_:1}),e(v,{class:"item",effect:"dark",trigger:"hover",content:"确定图像截取",placement:"bottom"},{default:t(()=>[e(n,{onClick:S,icon:m(Q),size:"small",loading:f.value},null,8,["icon","loading"])]),_:1})]),_:1})])):(h(),I(p,{key:0,class:"upload-demo",drag:"",action:"","auto-upload":!1,"show-file-list":!1,"on-change":c,accept:"image/*"},{default:t(()=>[e(o,{size:67},{default:t(()=>[e(m(T))]),_:1}),ie]),_:1}))]),_:1})]),_:1})])],64)}}});const pe=D(_e,[["__scopeId","data-v-83f891f9"]]),j=r=>(L("data-v-9b90a0ca"),r=r(),N(),r),me=j(()=>u("i",null," 账户设置",-1)),fe=j(()=>u("i",null," 资料设置",-1)),ge=E({__name:"Setting",setup(r){const i=b("Account");return(U,f)=>{const c=a("Setting",!0),w=a("el-icon"),V=a("el-collapse-item"),x=a("el-collapse"),S=a("el-card");return h(),I(S,{class:"box-card"},{default:t(()=>[e(x,{modelValue:i.value,"onUpdate:modelValue":f[0]||(f[0]=l=>i.value=l),accordion:""},{default:t(()=>[e(V,{name:"Account"},{title:t(()=>[e(w,null,{default:t(()=>[e(c)]),_:1}),me]),default:t(()=>[e(se)]),_:1}),e(V,{name:"UserInfo"},{title:t(()=>[e(w,null,{default:t(()=>[e(c)]),_:1}),fe]),default:t(()=>[e(pe)]),_:1})]),_:1},8,["modelValue"])]),_:1})}}});const we=D(ge,[["__scopeId","data-v-9b90a0ca"]]);export{we as default};
