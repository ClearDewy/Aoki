import{c as F,e as Y}from"./style-297731c9.js";import{d as P,r,L as b,f as c,u as p,o as h,n as L,w as t,b as u,h as I,K as ge,y as v,e,p as D,x as _,z as Te,q as ie,s as de,_ as ce,a as oe,c as B,X as Ve,Y as ne,V as O,a3 as xe,F as se,v as ke,a4 as Me,Q as we,R as k,B as X,U as Ce}from"./index-3165b167.js";const ue=y=>(ie("data-v-64743b4f"),y=y(),de(),y),Ue={class:"card-header"},$e=ue(()=>u("h2",{style:{margin:"auto"}},"我的选题",-1)),De={style:{display:"flex","justify-content":"center","align-items":"center",height:"100%",width:"100%","flex-direction":"column"}},Ie={style:{"font-size":"100px",margin:"0"}},Le=ue(()=>u("div",{class:"card-header"},[u("span",null,"选题列表")],-1)),Ne=P({__name:"TopicStudent",setup(y){const d=r(),V=r([]),w=r(new Date(0)),x=r(new Date(0)),C=()=>{D.getTopics(b.value.id).then(s=>{V.value=s.data}).catch(s=>{_("获取选题列表失败")})},N=()=>{D.getMyTopic(b.value.id).then(s=>{Te.setItem("topic",s.data),d.value=s.data}).catch(s=>{_(s.message)})},A=()=>{D.getTopicTime(b.value.id).then(s=>{w.value=new Date(s.data.beginTime),x.value=new Date(s.data.endTime)}).catch(s=>{console.log(s),_("获取选课时间失败")})},R=s=>{D.addTopicMember(s).then(n=>{N()}).catch(n=>{_("选题失败:"+n.message)})},j=s=>{D.removeTopicMember(s).then(n=>{d.value=void 0,C()}).catch(n=>{_("退选失败:"+n.message)})};N(),d.value||(b.value.topicMode?d.value={id:0,name:"暂无课题",ownerName:"未知",difficult:0,number:0,limit:0}:(A(),C()));const U=r(!(new Date>=w.value&&new Date<=x.value));return setInterval(()=>{const s=new Date;U.value=!(s>=w.value&&s<=x.value)},1e3),(s,n)=>{const S=c("el-button"),q=c("el-rate"),E=c("el-card"),M=c("el-table-column"),G=c("el-table");return p(b).topicMode||d.value?(h(),L(E,{key:0,class:"box-card","body-style":p(Y)},{header:t(()=>[u("div",Ue,[$e,p(b).topicMode?ge("",!0):(h(),L(S,{key:0,type:"danger",onClick:n[0]||(n[0]=m=>{var g;return j((g=d.value)==null?void 0:g.id)})},{default:t(()=>[I("退选")]),_:1}))])]),default:t(()=>{var m,g;return[u("div",De,[u("h1",Ie,v((m=d.value)==null?void 0:m.name),1),e(q,{size:"large",modelValue:d.value.difficult,"onUpdate:modelValue":n[1]||(n[1]=K=>d.value.difficult=K),colors:p(F),disabled:!0},null,8,["modelValue","colors"]),u("h3",null,v((g=d.value)==null?void 0:g.ownerName),1)])]}),_:1},8,["body-style"])):(h(),L(E,{key:1,class:"box-card","body-style":p(Y)},{header:t(()=>[Le]),default:t(()=>[e(G,{data:V.value,style:{height:"100%"}},{default:t(()=>[e(M,{prop:"name",label:"课题名称"}),e(M,{label:"难度"},{default:t(({row:m})=>[e(q,{modelValue:m.difficult,"onUpdate:modelValue":g=>m.difficult=g,colors:p(F),disabled:!0},null,8,["modelValue","onUpdate:modelValue","colors"])]),_:1}),e(M,{prop:"ownerName",label:"老师"}),e(M,{label:"人数"},{default:t(({row:m})=>[u("span",null,v(m.number)+" / "+v(m.limit),1)]),_:1}),e(M,{label:"操作"},{default:t(({row:m})=>[e(S,{type:"primary",onClick:g=>R(m.id),plain:"",disabled:m.number>=m.limit||U.value},{default:t(()=>[I("选择")]),_:2},1032,["onClick","disabled"])]),_:1})]),_:1},8,["data"])]),_:1},8,["body-style"]))}}});const Re=ce(Ne,[["__scopeId","data-v-64743b4f"]]),re=y=>(ie("data-v-609e2a55"),y=y(),de(),y),Se={class:"card-header"},ze=re(()=>u("h2",null,"我的课题",-1)),Be=re(()=>u("div",{class:"card-header"},[u("span",{style:{height:"32px",display:"flex","align-items":"center"}},"课题列表")],-1)),Fe={class:"dialog-footer"},Ae=["id"],je={key:0},qe={style:{width:"100%",display:"flex","justify-content":"space-between","align-items":"center"}},Ee={key:1},Ke=P({__name:"TopicTeacher",setup(y){const d=r(!1),V=r(!0),w=r(1),x=r(-1),C=r(!1),N=r(""),A=r([]),R=r([]),j=r([]),U=r(!1),s=a=>{we.confirm("是否确认取消?").then(()=>{a()}).catch(()=>{})},n=oe({id:-1,name:"",limit:1,difficult:0,lessonId:b.value.id}),S=r(),q=oe({name:[{required:!0,message:"请输入课题名",trigger:"blur"}]}),E=async a=>{a&&await a.validate((o,T)=>{o&&(V.value?k.createTopic(n).then(i=>{Q(),$(),X("创建课题成功"),d.value=!1}).catch(i=>{_("创建课题失败")}):k.updateTopic(n).then(i=>{Q(),$(),X("更改课题成功"),d.value=!1}).catch(i=>{_("更改课题失败")}))})},M=a=>{V.value=!1,w.value=Math.max(1,a.number),n.name=a.name,n.id=a.id,n.difficult=a.difficult,n.limit=a.limit,d.value=!0},G=a=>{k.deleteTopic(a).then(o=>{Q(),$()}).catch(o=>{_("删除课程失败")})},m=a=>{k.getTopicMembers(a).then(o=>{R.value=o.data||[]}).catch(o=>{_("获取课题成员列表失败")})},g=a=>{N.value=a.name,x.value=a.id,m(a.id),C.value=!0},K=()=>{k.getNoTopicMembers(b.value.id).then(a=>{j.value=a.data}).catch(a=>{_("获取无课题成员失败")})},pe=()=>{K(),U.value=!0},me=a=>{k.addTopicMemberTeacher(x.value,a).then(o=>{K(),m(x.value),$(),X("添加成功")}).catch(o=>{_("添加失败")})},W=a=>{k.removeTopicMemberTeacher(x.value,a).then(o=>{m(x.value),$(),X("移除成员成功")}).catch(o=>{_("移除成员失败")})},Z=r([]),ee=r([]),$=()=>{D.getTopics(b.value.id).then(a=>{Z.value=a.data}).catch(a=>{_("获取选题列表失败")})},Q=()=>{k.getMyTopics(b.value.id).then(a=>{ee.value=a.data}).catch(a=>{_("获取我的课题失败"),_(a.message)})};return Q(),$(),(a,o)=>{const T=c("el-button"),i=c("el-table-column"),H=c("el-rate"),z=c("el-table"),le=c("el-card"),_e=c("el-input"),J=c("el-form-item"),fe=c("el-input-number"),ve=c("el-form"),te=c("el-dialog"),ae=c("el-avatar"),be=c("el-collapse-item"),he=c("el-collapse"),ye=c("el-drawer");return h(),B(se,null,[e(le,{class:"box-card",style:{"margin-right":"10px"},"body-style":p(Y)},{header:t(()=>[u("div",Se,[ze,e(T,{text:"",onClick:o[0]||(o[0]=l=>{V.value=!0,d.value=!0})},{default:t(()=>[I("新建课题")]),_:1})])]),default:t(()=>[e(z,{data:ee.value,style:{height:"100%"},onRowClick:g},{default:t(()=>[e(i,{prop:"name",label:"课题名称"}),e(i,{label:"难度"},{default:t(({row:l})=>[e(H,{modelValue:l.difficult,"onUpdate:modelValue":f=>l.difficult=f,colors:p(F),disabled:!0},null,8,["modelValue","onUpdate:modelValue","colors"])]),_:1}),e(i,{prop:"ownerName",label:"老师"}),e(i,{label:"人数"},{default:t(({row:l})=>[u("span",null,v(l.number)+" / "+v(l.limit),1)]),_:1}),e(i,{label:"操作"},{default:t(({row:l})=>[e(T,{type:"primary",icon:p(Ve),onClick:ne(f=>M(l),["stop"]),circle:""},null,8,["icon","onClick"]),e(T,{type:"danger",icon:p(O),onClick:ne(f=>G(l.id),["stop"]),circle:""},null,8,["icon","onClick"])]),_:1})]),_:1},8,["data"])]),_:1},8,["body-style"]),e(le,{class:"box-card",style:{"margin-left":"10px"},"body-style":p(Y)},{header:t(()=>[Be]),default:t(()=>[e(z,{data:Z.value,style:{height:"100%"}},{default:t(()=>[e(i,{prop:"name",label:"课题名称"}),e(i,{label:"难度"},{default:t(({row:l})=>[e(H,{modelValue:l.difficult,"onUpdate:modelValue":f=>l.difficult=f,colors:p(F),disabled:!0},null,8,["modelValue","onUpdate:modelValue","colors"])]),_:1}),e(i,{prop:"ownerName",label:"老师"}),e(i,{label:"人数"},{default:t(({row:l})=>[u("span",null,v(l.number)+" / "+v(l.limit),1)]),_:1}),e(i,{label:"人数"},{default:t(({row:l})=>[u("span",null,v(l.number)+" / "+v(l.limit),1)]),_:1})]),_:1},8,["data"])]),_:1},8,["body-style"]),e(te,{modelValue:d.value,"onUpdate:modelValue":o[6]||(o[6]=l=>d.value=l),title:V.value?"新建课题":"修改课题","before-close":s,"align-center":"",center:"",width:"750px"},{footer:t(()=>[u("span",Fe,[e(T,{onClick:o[4]||(o[4]=l=>d.value=!1)},{default:t(()=>[I("取消")]),_:1}),e(T,{type:"primary",onClick:o[5]||(o[5]=l=>E(S.value))},{default:t(()=>[I(" 确认 ")]),_:1})])]),default:t(()=>[e(ve,{ref_key:"ruleFormRef",ref:S,model:n,"label-width":"120px",rules:q,"label-position":"top",inline:!0},{default:t(()=>[e(J,{label:"阶段目标名称",prop:"name"},{default:t(()=>[e(_e,{modelValue:n.name,"onUpdate:modelValue":o[1]||(o[1]=l=>n.name=l),placeholder:"请输入课题名"},null,8,["modelValue"])]),_:1}),e(J,{label:"人数上限",prop:"limit"},{default:t(()=>[e(fe,{modelValue:n.limit,"onUpdate:modelValue":o[2]||(o[2]=l=>n.limit=l),min:V.value?1:w.value},null,8,["modelValue","min"])]),_:1}),e(J,{label:"难度",prop:"introduction"},{default:t(()=>[e(H,{modelValue:n.difficult,"onUpdate:modelValue":o[3]||(o[3]=l=>n.difficult=l),colors:p(F),"allow-half":""},null,8,["modelValue","colors"])]),_:1})]),_:1},8,["model","rules"])]),_:1},8,["modelValue","title"]),e(ye,{modelValue:C.value,"onUpdate:modelValue":o[8]||(o[8]=l=>C.value=l)},{header:t(({titleId:l,titleClass:f})=>[u("h4",{id:l,class:xe(f)},v(N.value),11,Ae),e(T,{onClick:pe},{default:t(()=>[I(" 添加成员 ")]),_:1})]),default:t(()=>[p(b).teamMode?(h(),B("div",je,[e(he,{modelValue:A.value,"onUpdate:modelValue":o[7]||(o[7]=l=>A.value=l)},{default:t(()=>[(h(!0),B(se,null,ke(R.value,l=>(h(),L(be,{name:l.id},{title:t(()=>[u("div",qe,[u("span",null,v(l.name),1),e(T,{onClick:f=>W(l.id),type:"danger",circle:"",icon:p(O)},null,8,["onClick","icon"])])]),default:t(()=>[e(z,{data:l.memberList,"show-header":!1,style:{height:"100%"}},{default:t(()=>[e(i,{prop:"avatarURL",label:"头像"},{default:t(f=>[e(ae,{src:f.row.avatarURL,fit:"scale-down",size:"small"},null,8,["src"])]),_:1}),e(i,{prop:"name",label:"姓名"}),e(i,{prop:"username",label:"学号"})]),_:2},1032,["data"])]),_:2},1032,["name"]))),256))]),_:1},8,["modelValue"])])):(h(),B("div",Ee,[e(z,{data:R.value,"show-header":!1,style:{height:"100%"}},{default:t(()=>[e(i,{prop:"avatarURL",label:"头像"},{default:t(({row:l})=>[e(ae,{src:l.avatarURL,fit:"scale-down",size:"small"},null,8,["src"])]),_:1}),e(i,{prop:"name",label:"姓名"}),e(i,{prop:"username",label:"学号"}),e(i,null,{default:t(({row:l})=>[e(T,{onClick:f=>W(l.id),type:"danger",circle:"",icon:p(O)},null,8,["onClick","icon"])]),_:1})]),_:1},8,["data"])]))]),_:1},8,["modelValue"]),e(te,{modelValue:U.value,"onUpdate:modelValue":o[9]||(o[9]=l=>U.value=l),title:"添加成员","before-close":s,"align-center":"",center:"",width:"450px"},{default:t(()=>[e(z,{data:j.value,style:{height:"100%"}},{default:t(()=>[e(i,{prop:"name",label:"名称",width:"300px"}),e(i,{label:"操作"},{default:t(({row:l})=>[e(T,{icon:p(Me),type:"primary",circle:"",onClick:f=>me(l.id)},null,8,["icon","onClick"])]),_:1})]),_:1},8,["data"])]),_:1},8,["modelValue"])],64)}}});const Qe=ce(Ke,[["__scopeId","data-v-609e2a55"]]),Xe={style:{display:"flex",width:"100%",height:"100%"}},He=P({__name:"Topic",setup(y){return(d,V)=>(h(),B("div",Xe,[p(Ce).role===2?(h(),L(Re,{key:0})):(h(),L(Qe,{key:1}))]))}});export{He as default};
